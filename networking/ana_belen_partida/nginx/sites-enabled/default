server {
    # Ejercicio 1
    listen 80 default_server;
    listen [::]:80 default_server;
    access_log /var/www/html/logs.log;

    root /var/www/html;

    index index.html index.htm index.nginx-debian.html;

    # Ejercicio 15
    location /logs.log {
        alias /var/www/html/logs.log;
        allow all;
    }

    server_name _;

    #Ejercicio 2
    location / {
        try_files $uri $uri/ =404;
    }

    #Ejercicios 3, 4, 5 y 6 se comprueban desde explorador
    
    #Ejercicio 7
    location /error {
        return 500;
    }

    #Ejercicio 8.
    location /metodo {
        if ($request_method = GET) {
            return 201 '{"codigo":"1", "mensaje":"Has hecho una peticion GET"}';
        }
        if ($request_method = POST) {
            return 201 '{"codigo":"1", "mensaje":"Has hecho una peticion POST"}';
        }
        if ($request_method = PUT) {
            return 201 '{"codigo":"1", "mensaje":"Has hecho una peticion PUT"}';
        }
        if ($request_method = DELETE) {
            return 201 '{"codigo":"1", "mensaje":"Has hecho una peticion DELETE"}';
        }
        return 503;
    }

    # Ejercicio 9
    location /cabecera {
        add_header Mi-cabecera "Mi cabecera";
        return 201;
    }

    # Ejercicio 10
    location /redireccion1 {
        return 302 https://w3schools.com;
    }

    # Ejercicio 11
    location /redireccion2 {
        return 302 http://0.0.0.0/cabecera;
    }

    # Ejercicio 14
    location /respuesta {
        if ($arg_json) {
            return 200 '{"codigo": "200", "mensaje": "Has solicitado un JSON"}';
        }
        if ($arg_html) {
            return 200 '<html><body><h1>Has solicitado un HTML</h1></body></html>';
        }
        return 400;
    }
}

# Ejercicio 12
# servidor en el puerto 8000
server {
    listen 8000;
    access_log /var/www/html/logs.log;

    index index.html index.htm index.nginx-debian.html;

    root /var/www/html;

    location / {
        try_files $uri $uri/ =403;
    }
    # Ejercicio 15
    location /logs.log {
        alias /var/www/html/logs.log;
        allow all;
    }
}

#Ejercicio 13
server {
    listen 443 ssl;
    server_name localhost;
    ssl_certificate /etc/ssl/certs/ssl-cert-snakeoil.pem;
    ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!MD5;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;
    location / {
    try_files $uri $uri/ =404;
    }
    # Ejercicio 15
    location /logs.log {
        alias /var/www/html/logs.log;
        allow all;
    }
   		#el user y contrase√±a es "usuario1" y "anabelen"
    	auth_basic "Acceso Restringido";
    	auth_basic_user_file /etc/nginx/.htpasswd;
}